<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Insert title here</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
	<div class="container" id="divRegistro">
		<div class="row">
			<div class="col-md-12">
				<input type="text" placeholder="Correo electrónico" id="email"><br>
				<input type="password" placeholder="Contraseña" id="pwd1"><br>
				<input type="password" placeholder="Repite contraseña" id="pwd2"><br>
				<button onclick="registrar()" id="btnRegistrar">Registrarse</button>
				<span id="mensajeRegistro"></span>
			</div> 
		</div>
	</div>

	<div class="container">
		<div class="row">
			<div class="col-md-8">
				<label for="selectBroker">Tipo de Broker:</label>
				<select id="selectBroker" onchange="selectBroker()">
					<option></option>
				</select>			
				<div id="divDatosUsuario" style="display:none">
					Nombre: <input type="text" id="nombre"><br>
					Número de jugadores: <input type="number" id="numero"><br>
					<button id="btnCrearPartida" onclick="crearPartida()">Crear</button>
					<button id="btnUnirseAPartida" onclick="unirse()">Unirse</button>
				</div>
			</div>
			<div class="col-md-4">
				<div class="row">
					<div id="divMensajes"></div>
				</div>
				<div class="row">
					<div id="divChat"></div>
				</div>
			</div>
		</div>
	</div>
	
	<div class="container" style="display:none" id="divTablero">
		<div class="row">
			<div class="col-md-12">
				<svg id="svgTablero" width="500" height="500" style="background-color:grey">
				</svg>
			</div>
		</div>
	</div>
	
	
	<script>
	</script>
	
	<script src="scripts/partidas.js"></script>
	<script src="scripts/tablero.js"></script>
	<script src="scripts/GestionCuentas.js"></script>
	<script>
	cargarBrokers();
	
	if (localStorage.nombre!=undefined)
		document.getElementById("nombre").value=localStorage.nombre;	
	
	function cargarBrokers() {
		var request = new XMLHttpRequest();	
		request.open("get", "cargarBrokers.jsp");
		request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		request.onreadystatechange=function() {
			if (request.readyState==4) {
				var respuesta=JSON.parse(request.responseText);
				if (respuesta.result=="OK") {
					var brokers=respuesta.mensaje;
					var selectBroker=document.getElementById("selectBroker");
					for (var i=0; i<brokers.length; i++) {
						var option=document.createElement("option");
						option.value=brokers[i];
						option.innerHTML=brokers[i];
						selectBroker.appendChild(option);
					}
				} else {
					divMensajes.innerHTML="Error: " + respuesta.mensaje;
				}
			}
		};
		request.send();	
	}
	
	function selectBroker() {
		var request = new XMLHttpRequest();	
		request.open("post", "selectBroker.jsp");
		request.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
		request.onreadystatechange=function() {
			if (request.readyState==4) {
				var respuesta=JSON.parse(request.responseText);
				if (respuesta.result=="OK") {
					divMensajes.innerHTML=respuesta.mensaje;
					document.getElementById("divDatosUsuario").setAttribute("style", "display:visible");
				} else
					divMensajes.innerHTML="Error: " + respuesta.mensaje;
			}
		};
		var p = {
			tipo : document.getElementById("selectBroker").value
		};
		request.send("p=" + JSON.stringify(p));		
	}
	</script>
</body>
</html>